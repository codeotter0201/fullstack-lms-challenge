# Release 1 (MVP) - 詳細規劃文件

> 💡 **這是 Thread 回覆訊息** - 針對主訊息的 Release 1 部分提供完整的技術規格與驗收標準

---

## 🎯 Release 1 目標

**時程**: Day 1-2 (2025-11-18 ~ 2025-11-19)
**核心目標**: 確保學員能順利完成核心學習流程

```
登入 → 觀看影片 → 進度自動儲存 → 獲得經驗值 → 自動升級
```

**成功指標**: PM 可以用測試帳號完整體驗上述流程,無重大阻塞性 Bug

---

## ✅ 核心功能詳細說明

### 1. 認證與權限系統

#### 登入方式
- **技術實作**: Email/Password 傳統認證 (Spring Security + JWT)
- **UI 設計**: 簡潔現代的登入介面 (自行設計,功能優先)
- **說明**: 為了簡化 R1 開發複雜度,我們使用傳統帳密認證,UI 採用簡潔實用的設計風格

#### 用戶身分組 (回應 Q4: 選擇 C - 三層架構)
- **R1 實作**: 三層架構 (學員 + 老師 + 管理員)
  - **學員**: 免費學員、付費學員
  - **老師**: 審核道館作業、管理課程
  - **管理員**: 管理用戶、系統設定

- **資料庫設計**: `users` - `user_roles` - `roles` (多對多關係)
  - 採用 RBAC 系統,**為未來多身分組擴充預留空間**
  - R1-R3 期間一個用戶只有一個主要角色
  - 資料結構支援未來一個用戶擁有多個身分組

- **未來擴充計畫** (R3-R4 後續):
  - 類似 Discord 的多身分組系統
  - 每個用戶可擁有多個身分 (例如: 同時是付費學員 + 助教)
  - 以「身分組」為單位進行權限控管

#### 權限驗證
- **前端驗證**: 檢查 JWT Token 中的用戶角色,控制 UI 顯示
- **後端驗證**: 每個 API 都會驗證用戶權限,防止越權訪問
- **付費內容鎖定**: 免費用戶看到付費課程時顯示鎖定圖示與升級提示

---

### 2. 課程觀看功能

#### YouTube 影片播放器
- **嵌入方式**: YouTube IFrame API
- **播放控制**: 播放、暫停、進度條、音量、全螢幕
- **載入狀態**: 顯示載入動畫,處理載入失敗情境

#### 付費課程鎖定機制
- **免費用戶行為**:
  - 看到課程列表中的付費課程標籤
  - 點擊付費課程時,影片區塊顯示鎖定遮罩
  - 顯示升級提示訊息
- **付費用戶行為**:
  - 可以正常觀看所有課程內容
  - 無任何限制

---

### 3. 影片進度追蹤

#### 自動儲存機制
- **頻率**: 每 10 秒自動發送進度更新請求
- **儲存內容**:
  - 課程 ID
  - 單元 ID
  - 影片當前播放秒數
  - 影片總長度
  - 完成百分比

#### 斷點續播
- **觸發時機**: 用戶重新進入課程頁面時
- **行為**: 自動跳轉到上次觀看的秒數,繼續播放
- **資料來源**: 從後端 API 取得上次觀看記錄

#### 完成判定
- **判定條件**: 觀看進度達到 **95% 以上**即視為完成
- **理由**: 避免因片尾黑畫面導致用戶需要完整看完 100% 才能獲得經驗值
- **狀態標記**: 完成後在資料庫標記該單元為已完成,防止重複獲得經驗值

---

### 4. 經驗值與升級系統

#### 經驗值獲得規則
- **獎勵機制**: 每支影片完成後獲得 **200 EXP**
- **觸發條件**: 觀看進度 ≥ 95%
- **防重複機制**: 每支影片只能獲得一次經驗值,資料庫記錄已完成的單元 ID

#### 升級機制
- **升級規則**: 採用階梯式經驗值系統 (非線性公式)
- **等級上限**: 36 級
- **自動升級**: 達到經驗值門檻時自動計算並更新等級,無須手動操作

**等級對照表** (部分等級):
| 等級 | 累積經驗值 | 升級所需經驗值 |
|------|-----------|---------------|
| 1    | 0         | 200           |
| 2    | 200       | 300           |
| 3    | 500       | 1000          |
| 4    | 1500      | 1500          |
| 5    | 3000      | 2000          |
| 6-35 | ...       | 2000 (固定)   |
| 36   | 65000     | - (滿級)      |

**範例**:
- 0 EXP → 等級 1
- 200 EXP → 等級 2
- 500 EXP → 等級 3
- 3000 EXP → 等級 5
- 65000 EXP → 等級 36 (滿級)

**說明**: 等級 6-35 每級固定需要 2000 經驗值,達到 65000 經驗值即為滿級

#### 視覺回饋
- **獲得經驗值**: 顯示 Toast 通知 "🎉 獲得 200 EXP!"
- **升級**: 顯示升級通知 (R1 簡單版本,R2 會加入動畫效果)

---

### 5. UI 設計 + RWD (回應 Q2, Q3: 功能優先,70-75% 基本外觀)

#### 設計原則 (根據 PM 回饋調整)
- **功能完整優先**: 確保所有功能可用,UI 簡潔實用即可
- **不復刻原版**: 自行設計現代化學習平台介面 (PM 明確表示可自己設計)
- **快速開發**: 使用 Tailwind CSS 預設樣式,避免過度客製化
- **70-75% 基本外觀**: 保持基本佈局,優先確保功能完整

#### 主要 UI 元件
- **導航欄**:
  - Logo (點擊返回首頁)
  - 課程選單 (R1 為下拉選單,顯示 1-2 門測試課程)
  - 通知圖示 (R1 僅外觀,無功能)
  - 用戶頭像 (點擊顯示下拉選單: 個人檔案、登出)

- **側邊欄**:
  - 課程章節導航
  - 單元列表 (影片、文章、測驗)
  - 完成狀態標記 (✓ 已完成)

- **主內容區**:
  - 影片播放器
  - 單元標題與描述
  - 進度條 (顯示觀看進度)

#### 響應式設計 (RWD)
- **桌面版** (≥1920px): 導航欄 + 固定側邊欄 + 主內容區
- **平板版** (768px-1919px): 導航欄 + 可收合側邊欄 + 主內容區
- **手機版** (<768px): 頂部導航欄 + 漢堡選單 (點擊開啟側邊欄抽屜)

---

## ⭕ UI 有外觀但功能未實現的部分

為了聚焦在核心學習流程,以下區塊在 Release 1 只有基本外觀,無實際功能:

### 課程列表
- **外觀**: 顯示 1-2 門測試課程的卡片
- **限制**: 無法切換到其他課程 (R2 才會實現多課程切換)

### 排行榜
- **外觀**: 顯示假資料 (模擬 10 名學員排名)
- **限制**: 無法排序、無即時更新、無分頁 (R2 實現真實排行榜)

### 道館
- **外觀**: 導航欄或側邊欄顯示道館入口
- **限制**: 點擊後顯示「即將推出」或空白頁面 (R3 實現道館功能)

### 通知
- **外觀**: 導航欄顯示通知鈴鐺圖示
- **限制**: 點擊無反應 (R4 實現通知系統)

**說明**: 這些 UI 元件的存在是為了確保整體介面的完整性,避免 R1 看起來過於空洞。

---

## 🧪 PM 測試清單

Release 1 完成後,您可以進行以下測試來驗收功能:

### 權限驗證測試
- [ ] 用免費用戶帳號登入
- [ ] 嘗試點擊付費課程
- [ ] 應該看到鎖定遮罩與升級提示訊息
- [ ] 確認無法觀看付費課程影片

### 付費用戶觀看測試
- [ ] 用付費用戶帳號登入
- [ ] 點擊任一課程單元 (影片)
- [ ] 影片應該可以正常播放
- [ ] 播放控制功能 (播放、暫停、進度條、全螢幕) 正常運作

### 經驗值獲得測試
- [ ] 觀看一支影片至少到 95% 進度
- [ ] 應該看到 Toast 通知顯示「獲得 200 EXP」
- [ ] 個人檔案或導航欄顯示經驗值增加
- [ ] 如果達到升級門檻,應該看到等級提升

### 斷點續播測試
- [ ] 觀看影片到一半 (例如 50% 進度)
- [ ] 關閉瀏覽器 (或切換到其他頁面)
- [ ] 重新開啟該課程頁面
- [ ] 影片應該從上次的位置 (50%) 繼續播放

### 手機版體驗測試
- [ ] 用手機瀏覽器開啟測試環境 URL
- [ ] 檢查導航欄是否正常顯示 (漢堡選單)
- [ ] 點擊漢堡選單,側邊欄應該以抽屜方式開啟
- [ ] 影片播放器應該適應手機螢幕寬度
- [ ] 所有功能在手機上可正常使用

---

## 📦 交付內容

Release 1 完成後,我們會提供以下完整的交付物:

### 1. 測試環境 URL
- **前端**: Vercel 部署 (自動 HTTPS)
- **後端**: Linode / AWS EC2 部署 (Docker Compose)
- **資料庫**: PostgreSQL (Docker,與後端同機部署)
- **URL 格式**:
  - 前端: `https://waterball-lms-xxx.vercel.app`
  - 後端: `https://api.waterball-lms.com` (需配置域名)

### 2. 測試帳號 (回應 Q4: 三層架構)

**R1 提供的測試帳號**:
- 免費學員: `student-free@example.com` / `password123`
- 付費學員: `student-paid@example.com` / `password123`
- 老師: `teacher@example.com` / `password123` (R3 道館審核時使用)
- 管理員: `admin@example.com` / `password123` (系統管理功能)

**說明**:
- R1 先實作基礎三層架構,一個用戶只有一個主要角色
- 資料庫結構已預留多身分組擴充空間
- 未來 R3-R4 會擴充為類似 Discord 的多身分組系統

### 3. Docker Compose 部署包
```
docker-compose.yml        # 本地開發: 前端 + 後端 + PostgreSQL
docker-compose.prod.yml   # 生產環境: 後端 + PostgreSQL (部署到 EC2/Linode)
.env.example              # 環境變數範本
docs/deployment/README.md # 部署說明文件
```

**本地開發**:
```bash
# 1. 複製環境變數
cp .env.example .env

# 2. 啟動所有服務
docker-compose up -d

# 3. 訪問應用
# 前端: http://localhost:3000
# 後端: http://localhost:8080
```

**生產環境部署 (EC2/Linode)**:
```bash
# 在 EC2/Linode 上執行
docker-compose -f docker-compose.prod.yml up -d
```

### 4. E2E 自動化測試報告 (Playwright)
- **測試範圍**:
  - 登入流程測試 (Email/Password 認證)
  - 付費/免費用戶權限驗證
  - 影片觀看完整流程
  - 進度自動儲存測試
  - 斷點續播測試
  - 經驗值獲得與升級測試

- **報告格式**: HTML 測試報告 + 截圖 (失敗案例)
- **成功標準**: 核心流程測試全部通過

### 5. Gherkin 可執行規格文件
```gherkin
# features/authentication.feature
Feature: 使用者認證
  Scenario: 付費用戶登入
    Given 我訪問登入頁面
    When 我輸入付費用戶帳號密碼
    Then 我應該成功登入並看到課程列表

# features/video-learning.feature
Feature: 核心學習流程
  Scenario: 付費用戶觀看影片並獲得經驗值
    Given 我是已登入的付費用戶
    When 我觀看一支影片至 95% 以上
    Then 我應該獲得 200 EXP
    And 我的等級應該正確更新
    And 影片進度應該被記錄

  Scenario: 斷點續播功能
    Given 我是已登入的付費用戶
    And 我觀看一支影片到 50% 進度
    When 我關閉瀏覽器並重新開啟該影片
    Then 影片應該從 50% 的位置繼續播放
```

### 6. GitHub Repository
- **前端**: Next.js 專案 (TypeScript + Tailwind CSS)
- **後端**: Spring Boot 專案 (Java 17+)
- **README.md**: 專案說明、技術棧、本地開發指南
- **CHANGELOG.md**: Release 1 功能清單

---

## 🏗️ 技術架構

### 前端技術棧
- **框架**: Next.js 14 (App Router)
- **語言**: TypeScript 5.x
- **UI 框架**: React 18
- **樣式**: Tailwind CSS 3.x
- **狀態管理**: React Context API (R1 簡單版,R2 可能改用 Zustand)
- **API 請求**: Fetch API + 自訂 API Client
- **影片播放**: YouTube IFrame API

### 後端技術棧
- **框架**: Spring Boot 3.x
- **語言**: Java 17+
- **安全**: Spring Security + JWT
- **資料庫**: Spring Data JPA + PostgreSQL 15
- **API 文件**: Swagger/OpenAPI (可選)
- **測試**: JUnit 5 + Mockito

### 部署架構

**生產環境**:
```
Frontend (Vercel)
    ↓ HTTPS
Backend (Linode / AWS EC2 - Docker)
    ↓
PostgreSQL (Docker,同機部署)
```

**本地開發**:
```
Frontend (localhost:3000)
    ↓
Backend (localhost:8080)
    ↓
PostgreSQL (Docker / localhost:5432)
```

---

## ✅ Release 1 成功標準

Release 1 視為成功的條件:

### 功能完整性
- [x] PM 可以完整體驗「登入 → 看影片 → 獲得經驗值 → 升級」流程
- [x] 付費/免費用戶權限驗證正確
- [x] 影片進度自動儲存,斷點續播正常
- [x] 經驗值計算正確,無重複獲得問題

### 品質標準
- [x] 無重大 Bug (定義: 阻塞核心流程的錯誤)
- [x] 核心流程 E2E 測試全部通過
- [x] 手機版可正常使用 (基本 RWD)

### UI 標準
- [x] UI 符合 Q3 設定的精準度目標 (70-75% 基本外觀)
- [x] 介面簡潔實用,功能可正常使用
- [x] RWD 在桌面/平板/手機都可正常顯示

### 部署標準
- [x] Docker Compose 可一鍵啟動
- [x] 測試環境部署成功,可公開訪問
- [x] 提供完整的部署文件

---

## 🔍 Q4 對 Release 1 的影響說明 (PM 已確認選擇 C)

### PM 選擇: 三層架構 + 未來多身分組擴充

**PM 回覆重點**:
- 短期: 學員 (免費/付費) + 老師 + 管理員 (三層架構)
- 長期願景: 類似 Discord 的多身分組系統 (一個用戶可有多個身分)
- 目前階段: 先簡單區分學生跟教師即可

### R1 實作策略

#### 資料庫設計
```sql
-- 採用多對多關係,為未來擴充預留空間
users (id, email, password, ...)
  ↓ 多對多
user_roles (user_id, role_id)
  ↓
roles (id, name, description)
```

#### 短期實作 (R1-R3)
- 一個用戶只有一個主要角色
- 簡單的 RBAC 權限驗證
- 前端根據角色顯示/隱藏功能

#### 長期擴充 (R3-R4 後續)
- 一個用戶可擁有多個身分組
- 身分組可組合權限 (例如: 付費學員 + 助教)
- 以「身分組」為單位進行細粒度權限控管

**開發成本**: R1 多花 4-6 小時設計權限架構,但避免未來重構

---

## 📞 下一步行動

### PM 已確認 (2025-11-19)
1. ✅ Q1: A (R1必須 + R2必須 + R3盡力 + R4可選)
2. ✅ Q2: A (功能完整,UI可簡化 - **可自己設計**)
3. ✅ Q3: C (70-75% 功能優先)
4. ✅ Q4: C (三層架構 + 未來多身分組)

### 立即開始 (開發團隊 - 2025-11-19)
1. ✅ 已根據 PM 回覆調整 R1 規劃文件
2. 🚀 建立專案骨架 (前後端 + Docker)
3. 🚀 開始核心功能開發
4. 📊 每日晚上提供進度簡報 (Discord 訊息)

---

**溝通方式**: Discord #需求訪談頻道 / 緊急事項隨時 @Ender
**期望回覆時間**: 
**完整規劃文件**: `docs/planning/releases-overview.md`

---

**文件版本**: v3.0-thread
**最後更新**: 2025-11-19
**對應主訊息**: `message-1-overview.md`
**變更記錄**:
- **v3.0 (2025-11-19)**: 根據 PM 回覆調整文件
  - UI 策略改為「自行設計,功能優先」(不復刻原版)
  - 確認三層架構 (學員+老師+管理員) + 預留多身分組擴充
  - 修正所有 Q5 → Q4 的問題編號
  - 更新測試帳號說明
  - 簡化 UI 相關描述,強調 70-75% 基本外觀
- v2.0 (2025-11-18): 修正認證方式說明,縮短時間線,澄清測試要求
